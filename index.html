<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>MBTI Answer Page</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-91GFT9ZJKW"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-91GFT9ZJKW");</script><link rel="stylesheet" href="/hsnumbti.bbef7afb.css"><script>let db,questions=[],currentQuestionIndex=0,openDB=indexedDB.open("MBTI_DB",2);async function loadQuestions(){try{let e=await fetch("./question.json"),t=await e.json();questions=Object.entries(t).map(([e,t])=>({questionId:e,...t})),questions=shuffleArray(questions),renderQuestion()}catch(e){console.error("Failed to load question.json:",e)}}function shuffleArray(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}function updateProgressBar(){let e=document.getElementById("progress-bar"),t=(currentQuestionIndex+1)/questions.length*100;e.style.width=`${t}%`}function renderQuestion(){let e=document.getElementById("question-container");e.innerHTML="";let t=questions[currentQuestionIndex];if(!t)return;let n=document.createElement("div");n.dataset.questionId=t.questionId,n.dataset.questionType=t.questionType,n.dataset.phase=t.phase;let r=document.createElement("p");r.className="text-2xl font-medium mb-8 text-center",r.textContent=`${t.question}`;let s=document.createElement("div");s.className="flex justify-between items-center gap-2";let o=document.createElement("span");o.className="text-sm text-gray-600 w-20 text-left",o.innerHTML="完全同意";let a=document.createElement("span");a.className="text-sm text-gray-600 w-20 text-right",a.innerHTML="完全不同意";let i=document.createElement("div");i.className="flex flex-1 justify-between gap-1";let l=["bg-lime-400 hover:bg-lime-600 active:bg-lime-700","bg-lime-300 hover:bg-lime-500 active:bg-lime-600","bg-lime-200 hover:bg-lime-400 active:bg-lime-500","bg-yellow-200 hover:bg-yellow-400 active:bg-yellow-500","bg-red-300 hover:bg-red-500 active:bg-red-600","bg-red-400 hover:bg-red-600 active:bg-red-700","bg-red-500 hover:bg-red-700 active:bg-red-800"],u=db.transaction(["answers"],"readonly").objectStore("answers").get(t.questionId);u.onsuccess=function(){let c=u.result?u.result.answer:null;for(let e=1;e<=7;e++){let n=document.createElement("button");n.className=`w-10 h-10 rounded-full focus:outline-none ${l[e-1]}`,n.setAttribute("aria-label",e),c===e&&n.classList.add("ring-4","ring-blue-500"),n.addEventListener("click",()=>{saveAnswer(t,e),goToNext()}),i.appendChild(n)}s.appendChild(o),s.appendChild(i),s.appendChild(a),n.appendChild(r),n.appendChild(s),e.appendChild(n),updateProgressBar()},u.onerror=function(){console.error("Failed to retrieve saved answer for question:",t.questionId)}}function saveAnswer(e,t){let n={questionId:e.questionId,questionType:e.questionType,phase:e.phase,answer:t,timestamp:Date.now()};db.transaction(["answers"],"readwrite").objectStore("answers").put(n)}function goToNext(){if(currentQuestionIndex<questions.length-1)currentQuestionIndex++,renderQuestion();else{let e=db.transaction(["answers"],"readonly").objectStore("answers").openCursor();e.onsuccess=e=>{let t=e.target.result;if(t){let e=t.value.questionId,n=questions.findIndex(t=>t.questionId===e);-1!==n&&(questions[n].answered=!0),t.continue()}else{let e=questions.findIndex(e=>!e.answered);-1!==e?(alert("You have unanswered questions. Jumping to the first unanswered question."),currentQuestionIndex=e,renderQuestion()):submitAnswers()}},e.onerror=()=>{console.error("Error checking unanswered questions."),alert("An error occurred while checking unanswered questions.")}}}function goToPrev(){currentQuestionIndex>0&&(currentQuestionIndex--,renderQuestion())}function submitAnswers(){let e=db.transaction(["answers"],"readonly").objectStore("answers").getAll();e.onsuccess=function(){let t=e.result,n={},r={},s={};t.forEach(e=>{let{questionType:t,phase:o,answer:a}=e;n[t]||(n[t]=0,r[t]=0,s[t]=0),"positive"===o?(n[t]+=a,r[t]+=7):"negative"===o&&(n[t]-=a,s[t]+=7)});let o={"揪/被揪":"I/N","訂外送/買午餐":"D/S","卷/抱佛脚":"H/L","電神/被電":"P/G"},a={};for(let[e,t]of Object.entries(n)){let n=r[e]+s[e],i=n/2,l=t+s[e];a[e]={type:l>i?o[e].split("/")[0]:o[e].split("/")[1],score:l,maxScore:n}}localStorage.setItem("mbtiResult",JSON.stringify(a)),window.location.href="./result.html"},e.onerror=function(){console.error("Failed to retrieve answers for submission."),alert("An error occurred while submitting your answers.")}}function clearDatabase(){let e=indexedDB.deleteDatabase("MBTI_DB");e.onsuccess=function(){console.log("Database deleted successfully."),alert("All data has been cleared.")},e.onerror=function(e){console.error("Error deleting database:",e.target.error),alert("An error occurred while clearing the database.")},e.onblocked=function(){console.warn("Database deletion blocked. Please close all other tabs using this database."),alert("Database deletion is blocked. Close all other tabs using this database and try again.")}}function calculateScores(){let e=db.transaction(["answers"],"readonly").objectStore("answers").getAll();e.onsuccess=function(){let t=e.result,n={},r={},s={},o={};t.forEach(e=>{let{questionType:t,phase:a,answer:i}=e;n[t]||(n[t]=0,r[t]=0,s[t]=0,o[t]=0),"positive"===a?(n[t]+=i,r[t]+=7,s[t]+=7):"negative"===a&&(n[t]-=i,r[t]-=7,o[t]-=7)});let a={"揪/被揪":"I/N","訂外送/買午餐":"D/S","卷/抱佛脚":"H/L","電神/被電":"P/G"},i={};for(let[e,t]of Object.entries(n)){let n=(s[e]-o[e])/2;var l=t-o[e];i[e]=l>n?a[e].split("/")[0]:a[e].split("/")[1]}localStorage.setItem("mbtiResult",JSON.stringify(i)),window.location.href="./result.html"},e.onerror=function(){console.error("Failed to retrieve answers for score calculation."),alert("An error occurred while calculating scores.")}}openDB.onupgradeneeded=function(e){(db=e.target.result).objectStoreNames.contains("answers")||db.createObjectStore("answers",{keyPath:"questionId"})},openDB.onsuccess=function(e){db=e.target.result,loadQuestions()};</script></head><body class="bg-dblue flex flex-col items-center justify-center min-h-screen p-4"> <div class="bg-white max-w-2xl p-6 rounded-2xl scale-in-center shadow-lg w-full" id="mainbox"> <div id="question-container" class="mb-6"></div>  <div class="flex flex-col gap-4 items-center justify-between md:flex-row"> <button onclick="goToPrev()" class="bg-gray-300 hover:bg-gray-400 md:text-base md:w-auto px-4 py-2 rounded-lg text-gray-800 text-sm w-full"> Prev </button> <div class="bg-gray-200 flex h-2.5 items-center justify-items-center md:w-[50%] mt-3 rounded-full w-full"> <div id="progress-bar" class="bg-blue-600 duration-500 h-2.5 rounded-full transition-all" style="width:0%"></div> </div> <button onclick="goToNext()" class="bg-blue-600 hover:bg-blue-700 md:text-base md:w-auto px-4 py-2 rounded-lg text-sm text-white w-full"> Next </button> </div> </div>  <div class="absolute bottom-20 md:bottom-16 right-4"> <button onclick="submitAnswers()" class="bg-green-500 hover:bg-green-600 md:text-base md:w-32 px-3 py-2 rounded-lg shadow-lg text-sm text-white w-28"> Submit </button> </div>  <div class="absolute bottom-8 md:bottom-4 right-4"> <button onclick="resetProgress()" class="bg-red-500 hover:bg-red-600 md:text-base md:w-32 px-3 py-2 rounded-lg shadow-lg text-sm text-white w-28"> Reset </button> </div> <script>function resetProgress(){confirm("Are you sure you want to reset your progress? This action cannot be undone.")&&(clearDatabase(),alert("Progress has been reset. Reloading the page..."),location.href="landing.html")}</script> </body></html>